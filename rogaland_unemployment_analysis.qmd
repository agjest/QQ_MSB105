---
title: 1999-2002
author: "Generated by Databot" 
date: "30 October 2025" 
format: 
    html: 
        toc: true 
        toc-depth: 3 
        code-fold: true 
        theme: cos intelligence (Claude from Anthropic) under general human direction. The contents have been reviewed and validated by ag, 30. October 2025.
---

## Executive Summary

This report analyzes unemployment patterns in Rogaland County, Norway, from 1999 to 2002. The analysis reveals:

-   **Overall trend**: Unemployment increased across all municipalities from 1999 to 2002
-   **Geographic patterns**: Urban coastal areas experienced higher unemployment than rural inland areas
-   **Seasonal patterns**: Consistent seasonal variation with lowest unemployment in May-June and highest in winter months
-   **Urban-rural differences**: Urban areas show unique August unemployment peaks, while rural areas have smoother seasonal patterns

## Data

Overview

```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(sf)
library(giscoR)
library(readxl)

# NOTE: Add your data loading code here
# For example: 
RegHeltLedige <- readxl::read_excel(
path = "/Users/ag/dev/QQ_MSB105/explore-data/import-export-data/RegHeltLedige.xlsx", 
#  path = "./RegHeltLedige.xlsx", 
  sheet = "RegHeltLedige",
  skip = 1
  )

names(RegHeltLedige) <- c("knr_kname", "age_group", "year_month", "unempl")

# Fill in for NA
RegHeltLedige <- fill(
  data = RegHeltLedige,
  # column to fill, Note use of c() when multiple columns
  c(knr_kname, age_group),
  # NOTE! .direction, NOT direction
  .direction = "down")


# The analysis assumes RegHeltLedige is already loaded

# Data structure
glimpse(RegHeltLedige)
```

The **RegHeltLedige** dataset contains {r} nrow(RegHeltLedige) observations of unemployment data across:

-   **`{r} n_distinct(RegHeltLedige$knr_kname)`** municipalities in Rogaland County
-   **3 age groups**: 15-74 år (overall working age), 15-29 år (youth), 30-74 år (older workers)
-   **Time period**: Monthly data from 1999 to 2002
-   **Missing values**: `{r} sum(is.na(as.numeric(RegHeltLedige$unempl)))` \## 2002 Unemployment Summary

```{r data-2002}
# Prepare 2002 data
data_2002 <- RegHeltLedige |>
  filter(str_starts(year_month, "2002")) |>
  mutate(unempl_num = as.numeric(unempl))

# Summary statistics by age group
summary_2002 <- data_2002 |>
  group_by(age_group) |>
  summarise(
    n_obs = n(),
    missing = sum(is.na(unempl_num)),
    mean_unempl = mean(unempl_num, na.rm = TRUE),
    median_unempl = median(unempl_num, na.rm = TRUE),
    min_unempl = min(unempl_num, na.rm = TRUE),
    max_unempl = max(unempl_num, na.rm = TRUE)
  )

summary_2002
```

### Key Statistics for 2002

-   **Overall unemployment rate**: `{r} round(mean(data_2002$unempl_num, na.rm = TRUE), 2)`% (mean), `{r} round(median(data_2002$unempl_num, na.rm = TRUE), 2)`% (median)
-   **Youth unemployment (15-29 år)**: `{r} round(filter(summary_2002, age_group == "15-29 år")$mean_unempl, 2)`% - significantly higher than older workers
-   **Range**: `{r} round(min(data_2002$unempl_num, na.rm = TRUE), 1)`% to `{r} round(max(data_2002$unempl_num, na.rm = TRUE), 1)`%

### Municipalities with Highest/Lowest Unemployment (2002)

```{r top-bottom-2002}
# Calculate municipal averages for 2002
municipal_2002 <- data_2002 |>
  filter(age_group == "15-74 år") |>
  group_by(knr_kname) |>
  summarise(avg_unempl = mean(unempl_num, na.rm = TRUE)) |>
  arrange(desc(avg_unempl))

# Top 5 highest
cat("HIGHEST UNEMPLOYMENT:\n")
head(municipal_2002, 5)

# Bottom 5 lowest
cat("\nLOWEST UNEMPLOYMENT:\n")
tail(municipal_2002, 5)
```

## Geographic Distribution

```{r map-2002, fig.width=10, fig.height=8, message=FALSE, warning=FALSE}
# Load Norwegian municipality boundaries
norway_municipalities <- gisco_get_lau(country
 = "NO", year = "2016")

# Prepare data for mapping
unemp_for_map <- data_2002 |>
  filter(age_group == "15-74 år") |>
  mutate(knr = str_extract(knr_kname, "^\\d+")) |>
  group_by(knr, knr_kname) |>
  summarise(avg_unempl = mean(unempl_num, na.rm = TRUE), .groups = "drop")

# Join with geographic boundaries
rogaland_map <- norway_municipalities |>
  filter(str_starts(LAU_ID, "11")) |>
  left_join(unemp_for_map, by = c("LAU_ID" = "knr"))

# Create map
ggplot(rogaland_map) +
  geom_sf(aes(fill = avg_unempl), color = "white", size = 0.3) +
  scale_fill_viridis_c(
    option = "plasma",
    name = "Unemployment\nRate (%)",
    na.value = "grey80",
    direction = -1
  ) +
  labs(
    title = "Average Unemployment Rate in Rogaland County (2002)",
    subtitle = "Age group: 15-74 years",
    caption = "Data: RegHeltLedige | Grey areas indicate missing data"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    legend.position = "right"
  )
```

The map reveals a clear **urban-rural divide**:

-   **Highest unemployment**: Coastal urban areas (Utsira, Haugesund, Stavanger, Karmøy)
-   **Lowest unemployment**: Rural inland municipalities (Bjerkreim, Finnøy, Vindafjord)

## Temporal Trends (1999-2002)

```{r trends-analysis}
# Calculate unemployment change from 1999 to 2002
unemp_time <- RegHeltLedige |>
  filter(age_group == "15-74 år") |>
  mutate(
    unempl_num = as.numeric(unempl),
    year = as.numeric(str_sub(year_month, 1, 4)),
    knr = str_extract(knr_kname, "^\\d+"),
    municipality = str_remove(knr_kname, "^\\d+\\s+")
  ) |>
  filter(!is.na(unempl_num), !is.na(year))

# Annual averages
annual_avg <- unemp_time |>
  group_by(knr, municipality, year) |>
  summarise(avg_unempl = mean(unempl_num, na.rm = TRUE), .groups = "drop")

# Calculate change from 1999 to 2002
change_99_02 <- annual_avg |>
  filter(year %in% c(1999, 2002)) |>
  pivot_wider(names_from = year, values_from = avg_unempl, names_prefix = "year_") |>
  mutate(
    change = year_2002 - year_1999,
    pct_change = (change / year_1999) * 100
  ) |>
  arrange(desc(change))

# Show top changes
head(change_99_02, 10)
```

### Key Finding: Universal Increase

**All municipalities experienced unemployment increases from 1999 to 2002**, suggesting regional or national economic factors.

**Largest increases:**

-   **Utsira**: +255% (1.4% → 5.0%)
-   **Bokn**: +127% (1.0% → 2.2%)
-   **Tysvær**: +79% (1.6% → 2.9%)

**Smallest increases:**

-   **Vindafjord**: +15% (1.3% → 1.4%)
-   **Suldal**: +29% (1.3% → 1.7%)

### Trend Visualization

```{r trends-plot, fig.width=10, fig.height=6}
# Select diverse municipalities for visualization
selected_munis <- c("1151", "1103", "1106", "1114", "1154", "1135")

annual_avg |>
  filter(knr %in% selected_munis) |>
  ggplot(aes(x = year, y = avg_unempl, color = municipality, group = municipality)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3) +
  scale_x_continuous(breaks = 1999:2002) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    title = "Unemployment Rate Trends (1999-2002)",
    subtitle = "Selected Rogaland municipalities showing diverse patterns",
    x = "Year",
    y = "Unemployment Rate (%)",
    color = "Municipality",
    caption = "Age group: 15-74 years | Data: RegHeltLedige"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "right",
    panel.grid.minor = element_blank()
  )
```

### Geographic Distribution of Change

```{r change-map, fig.width=10, fig.height=8}
# Create map showing change
rogaland_change <- norway_municipalities |>
  filter(str_starts(LAU_ID, "11")) |>
  left_join(
    change_99_02 |> select(knr, change, pct_change),
    by = c("LAU_ID" = "knr")
  )

ggplot(rogaland_change) +
  geom_sf(aes(fill = change), color = "white", size = 0.3) +
  scale_fill_gradient2(
    low = "#2166ac",
    mid = "#f7f7f7",
    high = "#b2182b",
    midpoint = 1,
    name = "Change in\nUnemployment\nRate (%)",
    na.value = "grey80"
  ) +
  labs(
    title = "Change in Unemployment Rate (1999 → 2002)",
    subtitle = "Rogaland County | Age group: 15-74 years",
    caption = "Data: RegHeltLedige | Red = Increase"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    legend.position = "right"
  )
```

## Seasonal Patterns

```{r seasonal-analysis}
# Analyze seasonal patterns
seasonal_data <- RegHeltLedige |>
  filter(age_group == "15-74 år") |>
  mutate(
    unempl_num = as.numeric(unempl),
    year = as.numeric(str_sub(year_month, 1, 4)),
    month = as.numeric(str_sub(year_month, 6, 7)),
    month_name = month.abb[month]
  ) |>
  filter(!is.na(unempl_num), !is.na(month))

# Monthly averages across all years
monthly_avg <- seasonal_data |>
  group_by(month, month_name) |>
  summarise(
    avg_unempl = mean(unempl_num, na.rm = TRUE),
    sd_unempl = sd(unempl_num, na.rm = TRUE),
    .groups = "drop"
  )

monthly_avg
```

### Overall Seasonal Pattern

```{r seasonal-plot, fig.width=10, fig.height=6}
monthly_avg |>
  ggplot(aes(x = month, y = avg_unempl)) +
  geom_line(linewidth = 1.2, color = "#2166ac") +
  geom_point(size = 3, color = "#2166ac") +
  geom_ribbon(aes(ymin = avg_unempl - sd_unempl, ymax = avg_unempl + sd_unempl), 
              alpha = 0.2, fill = "#2166ac") +
  scale_x_continuous(breaks = 1:12, labels = month.abb) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    title = "Seasonal Unemployment Pattern in Rogaland (1999-2002)",
    subtitle = "Average across all municipalities | Shaded area shows ±1 standard deviation",
    x = "Month",
    y = "Unemployment Rate (%)",
    caption = "Age group: 15-74 years | Data: RegHeltLedige"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.minor = element_blank()
  )
```

**Key seasonal findings:**

-   **Lowest unemployment**: May-June (\~2.0-2.1%) - spring hiring season
-   **Highest unemployment**: December-January (\~2.4%) - winter slowdown
-   **Secondary peak**: July-August (\~2.3-2.4%) - possibly due to student labor market entry
-   **Seasonal amplitude**: \~0.4 percentage points (\~20% relative variation)

### Seasonal Patterns by Year

```{r seasonal-by-year, fig.width=10, fig.height=6}
seasonal_by_year <- seasonal_data |>
  group_by(year, month, month_name) |>
  summarise(avg_unempl = mean(unempl_num, na.rm = TRUE), .groups = "drop")

ggplot(seasonal_by_year, aes(x = month, y = avg_unempl, color = factor(year), group = year)) +
  geom_line(linewidth = 1.1) +
  geom_point(size = 2.5) +
  scale_x_continuous(breaks = 1:12, labels = month.abb) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  scale_color_viridis_d(name = "Year") +
  labs(
    title = "Seasonal Unemployment Patterns by Year",
    subtitle = "Rogaland County | Each line represents one year",
    x = "Month",
    y = "Unemployment Rate (%)",
    caption = "Age group: 15-74 years | Data: RegHeltLedige"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.minor = element_blank(),
    legend.position = "right"
  )
```

The seasonal pattern is **consistent across all years**, with each year showing the same general shape despite different overall levels.

## Urban vs Rural Patterns

```{r urban-rural-analysis}
# Classify municipalities
seasonal_data_full <- RegHeltLedige |>
  filter(age_group == "15-74 år") |>
  mutate(
    unempl_num = as.numeric(unempl),
    year = as.numeric(str_sub(year_month, 1, 4)),
    month = as.numeric(str_sub(year_month, 6, 7)),
    month_name = month.abb[month],
    knr = str_extract(knr_kname, "^\\d+"),
    municipality = str_remove(knr_kname, "^\\d+\\s+"),
    urban_rural = case_when(
      knr %in% c("1103", "1102", "1108", "1106") ~ "Urban",
      knr %in% c("1124", "1127", "1149", "1130") ~ "Suburban",
      TRUE ~ "Rural"
    )
  ) |>
  filter(!is.na(unempl_num), !is.na(month))

# Calculate seasonal patterns by type
seasonal_by_type <- seasonal_data_full |>
  group_by(urban_rural, month, month_name) |>
  summarise(
    avg_unempl = mean(unempl_num, na.rm = TRUE),
    sd_unempl = sd(unempl_num, na.rm = TRUE),
    .groups = "drop"
  )

# Calculate seasonal amplitude
seasonal_range <- seasonal_by_type |>
  group_by(urban_rural) |>
  summarise(
    lowest = min(avg_unempl),
    highest = max(avg_unempl),
    amplitude = highest - lowest,
    lowest_month = month_name[which.min(avg_unempl)],
    highest_month = month_name[which.max(avg_unempl)]
  )

seasonal_range
```

### Urban-Rural Comparison

```{r urban-rural-plot, fig.width=10, fig.height=6}
ggplot(seasonal_by_type, aes(x = month, y = avg_unempl, color = urban_rural, group = urban_rural)) +
  geom_line(linewidth = 1.3) +
  geom_point(size = 3) +
  scale_x_continuous(breaks = 1:12, labels = month.abb) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  scale_color_manual(
    values = c("Urban" = "#d95f02", "Suburban" = "#7570b3", "Rural" = "#1b9e77"),
    name = "Municipality Type"
  ) +
  labs(
    title = "Seasonal Unemployment Patterns by Municipality Type",
    subtitle = "Urban municipalities have consistently higher unemployment but similar seasonality",
    x = "Month",
    y = "Unemployment Rate (%)",
    caption = "Age group: 15-74 years | Rogaland County (1999-2002) | Data: RegHeltLedige"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10),
    panel.grid.minor = element_blank(),
    legend.position = "right"
  )
```

### Key Urban-Rural Differences

**Unemployment levels:**

-   **Urban**: `{r} round(mean(filter(seasonal_by_type, urban_rural == "Urban")$avg_unempl), 2)`% average (highest)
-   **Suburban**: `{r} round(mean(filter(seasonal_by_type, urban_rural == "Suburban")$avg_unempl), 2)`% average
-   **Rural**: `{r} round(mean(filter(seasonal_by_type, urban_rural == "Rural")$avg_unempl), 2)`% average (lowest)

**Seasonal amplitude:**

-   **Suburban**: `{r} round(filter(seasonal_range, urban_rural == "Suburban")$amplitude, 2)` percentage points (largest swing)
-   **Urban**: `{r} round(filter(seasonal_range, urban_rural == "Urban")$amplitude, 2)` percentage points
-   **Rural**: `{r} round(filter(seasonal_range, urban_rural == "Rural")$amplitude, 2)` percentage points (smallest swing)

**Unique findings:**

-   **Urban municipalities** show a distinctive **August unemployment peak** not seen in rural areas
-   **Rural municipalities** have the smoothest seasonal pattern, likely due to more stable employment in agriculture and smaller local industries
-   **Suburban areas** experience the largest seasonal swings, possibly due to their mix of urban commuters and local seasonal employment

## Conclusions

1.  **Rising unemployment trend**: All Rogaland municipalities experienced unemployment increases from 1999 to 2002, with Utsira showing the most dramatic increase (+255%).

2.  **Urban-rural divide**: Urban coastal areas consistently showed higher unemployment rates (\~3.5%) compared to rural inland areas (\~1.9%).

3.  **Predictable seasonality**: Unemployment follows a consistent seasonal pattern with:

    -   Spring lows (May-June)
    -   Winter highs (December-January)
    -   Consistent pattern across all years

4.  **Municipality-specific patterns**:

    -   Small municipalities (e.g., Utsira, Sauda) show extreme seasonal and temporal variations
    -   Larger urban centers show more stability but consistently higher base rates

5.  **Urban August anomaly**: Urban municipalities uniquely show an August unemployment peak, possibly related to industrial shutdowns during summer holidays.

## Data Quality Notes

-   **Missing values**: `{r} sum(is.na(as.numeric(RegHeltLedige$unempl)))` missing unemployment values out of `{r} nrow(RegHeltLedige)` observations
-   The `unempl` column is stored as character and requires conversion to numeric for analysis
-   Some municipalities have more missing data than others, particularly in 2002

## Recommendations for Further Analysis

1.  Investigate economic factors behind the 1999-2002 unemployment increase (oil industry, fishing, etc.)
2.  Analyze the unique August urban unemployment peak in detail
3.  Examine extreme seasonal variations in specific municipalities (e.g., Sauda)
4.  Compare youth (15-29) versus older worker (30-74) trends and patterns
5.  Extend analysis beyond 2002 if more recent data becomes available

------------------------------------------------------------------------

**Analysis completed**: `{r} format(Sys.Date(), "%d %B %Y")`

```{r}
#| echo: false
# siste
```
